[uwsgi]
chdir = /home/syncano/app/
log-format = %(addr) - [%(ltime)] %(host) %(method) %(uri) => generated %(size) bytes in %(msecs) msecs (%(proto) %(status))

; ; scaling - disabled due to https://github.com/unbit/uwsgi/issues/1702
; cheaper-algo = spare
; cheaper = 4
; cheaper-initial = 4
; cheaper-step = 2
workers = 8

master = true
vacuum = true
module = conf.wsgi
limit-post = 134217728
buffer-size = 8192
listen = 128

touch-reload = settings/common.py
if-env = AUTORELOAD
py-autoreload = 1
endif

socket-timeout = 30
socket = :8100
http = :8000
static-map = /static=static

uid = syncano
gid = syncano

die-on-term = true
need-app = true
single-interpreter = true
ignore-sigpipe = true
close-on-exec = true
enable-threads = true

worker-reload-mercy = 310
reload-mercy = 310

; offloading
offload-threads = 2
http-websockets = true

; if UWSGI_HANDLER is defined, do not send the headers generated by Django
response-route-if-not = empty:${UWSGI_HANDLER} disableheaders:
; if UWSGI_HANDLER is defined, offload the request to the external uwsgi app
response-route-if-not = empty:${UWSGI_HANDLER} uwsgi:${UWSGI_HANDLER},0,0
; if OFFLOAD_HANDLER is defined, do not send the headers generated by Django
response-route-if-not = empty:${OFFLOAD_HANDLER} disableheaders:
; if OFFLOAD_HANDLER is defined, offload the request to the offload app running
response-route-if-not = empty:${OFFLOAD_HANDLER} uwsgi:127.0.0.1:8003,0,0

stats = :1717
stats-http = true

safe-pidfile = /tmp/uwsgi.pid
